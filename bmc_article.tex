%% BioMed_Central_Tex_Template_v1.06
%%                                      %
%  bmc_article.tex            ver: 1.06 %
%                                       %

%%IMPORTANT: do not delete the first line of this template
%%It must be present to enable the BMC Submission system to
%%recognise this template!!

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                     %%
%%  LaTeX template for BioMed Central  %%
%%     journal article submissions     %%
%%                                     %%
%%          <8 June 2012>              %%
%%                                     %%
%%                                     %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                                                 %%
%% For instructions on how to fill out this Tex template           %%
%% document please refer to Readme.html and the instructions for   %%
%% authors page on the biomed central website                      %%
%% http://www.biomedcentral.com/info/authors/                      %%
%%                                                                 %%
%% Please do not use \input{...} to include other tex files.       %%
%% Submit your LaTeX manuscript as one .tex document.              %%
%%                                                                 %%
%% All additional figures and files should be attached             %%
%% separately and not embedded in the \TeX\ document itself.       %%
%%                                                                 %%
%% BioMed Central currently use the MikTex distribution of         %%
%% TeX for Windows) of TeX and LaTeX.  This is available from      %%
%% http://www.miktex.org                                           %%
%%                                                                 %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% additional documentclass options:
%  [doublespacing]
%  [linenumbers]   - put the line numbers on margins

%%% loading packages, author definitions

\documentclass[twocolumn]{bmcart}% uncomment this for twocolumn layout and comment line below
% \documentclass{bmcart}

%%% Load packages
\usepackage{amsthm,amsmath}
\RequirePackage{natbib}
%\RequirePackage[authoryear]{natbib}% uncomment this for author-year bibliography
\RequirePackage{hyperref}
\usepackage[utf8]{inputenc} %unicode support
%\usepackage[applemac]{inputenc} %applemac support if unicode package fails
%\usepackage[latin1]{inputenc} %UNIX support if unicode package fails
\usepackage{lineno} % for line numbers
\usepackage{textcomp} % for single quotes
% orcid code from https://tex.stackexchange.com/questions/445563/ieeetran-how-to-include-orcid-in-tex-pdf-with-pdflatex/445583#445583
\usepackage{scalerel}
\usepackage{tikz}
\usetikzlibrary{svg.path}

\definecolor{orcidlogocol}{HTML}{A6CE39}
\tikzset{
    orcidlogo/.pic={
        \fill[orcidlogocol] svg{M256,128c0,70.7-57.3,128-128,128C57.3,256,0,198.7,0,128C0,57.3,57.3,0,128,0C198.7,0,256,57.3,256,128z};
        \fill[white] svg{M86.3,186.2H70.9V79.1h15.4v48.4V186.2z}
        svg{M108.9,79.1h41.6c39.6,0,57,28.3,57,53.6c0,27.5-21.5,53.6-56.8,53.6h-41.8V79.1z M124.3,172.4h24.5c34.9,0,42.9-26.5,42.9-39.7c0-21.5-13.7-39.7-43.7-39.7h-23.7V172.4z}
        svg{M88.7,56.8c0,5.5-4.5,10.1-10.1,10.1c-5.6,0-10.1-4.6-10.1-10.1c0-5.6,4.5-10.1,10.1-10.1C84.2,46.7,88.7,51.3,88.7,56.8z};
    }
}

\newcommand\orcidicon[1]{\href{https://orcid.org/#1}{\mbox{\scalerel*{
                \begin{tikzpicture}[yscale=-1,transform shape]
                \pic{orcidlogo};
                \end{tikzpicture}
            }{|}}}}
\usepackage{tcolorbox}
\usepackage{lineno}
\usepackage{textcomp}
\usepackage{enumitem}
\usepackage{graphicx}
\graphicspath{ {./images/} }
\usepackage{hyperref} %<--- Load after everything else

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                             %%
%%  If you wish to display your graphics for   %%
%%  your own use using includegraphic or       %%
%%  includegraphics, then comment out the      %%
%%  following two lines of code.               %%
%%  NB: These line *must* be included when     %%
%%  submitting to BMC.                         %%
%%  All figure files must be submitted as      %%
%%  separate graphics through the BMC          %%
%%  submission process, not included in the    %%
%%  submitted article.                         %%
%%                                             %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%\def\includegraphic{}
%\def\includegraphics{}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

%%% Put your definitions there:
\startlocaldefs
\usepackage{url}
\endlocaldefs

 \newenvironment{handson_box}
    {\begin{center}
    
    \begin{tabular}{|p{0.9\textwidth/2}|}
    \hline\\
    }
    { 
    \\\\\hline
    \end{tabular} 
    \end{center}
    }    

\newcounter{handsoncounter}
\newtcolorbox[use counter=handsoncounter,number format=\arabic]{handson_box_colour}[2][]{boxrule=0.3mm,colback=gray!5!white,colframe=bmcblue, arc=0mm, title=Hands-on \thetcbcounter: #2,#1}
%\newtcolorbox{handson_box_colour}{boxrule=0.3mm,colback=gray!5!white,colframe=bmcblue, arc=0mm}

%%% Begin ...
\begin{document}

%%% Start of article front matter
\begin{frontmatter}

\begin{fmbox}
\dochead{Educational}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the title of your article here     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{Intuitive, reproducible high-throughput molecular dynamics in Galaxy: a tutorial}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors here                   %%
%%                                          %%
%% Specify information, if available,       %%
%% in the form:                             %%
%%   <key>={<id1>,<id2>}                    %%
%%   <key>=                                 %%
%% Comment or delete the keys which are     %%
%% not used. Repeat \author command as much %%
%% as required.                             %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\author[ addressref={aff1},                   % id's of addresses, e.g. {aff1,aff2}
   noteref={n1},                        % id's of article notes, if any
   email={sbray1371@gmail.com}   % email address
]{\inits{SAB}\fnm{Simon A} \snm{Bray}} \orcidicon{0000-0002-0621-6705}
\author[
   addressref={aff2},
   noteref={n1},
   email={}
]{\inits{TS}\fnm{Tharindu} \snm{Senapathi}} \orcidicon{0000-0002-3277-4022}
\author[
   addressref={aff2},
   email={chris.barnett@uct.ac.za}
]{\inits{CB}\fnm{Christopher B} \snm{Barnett}} \orcidicon{0000-0002-1467-5741}
\author[
   addressref={aff1},
   corref={aff1},
   email={gruening@informatik.uni-freiburg.de}
]{\inits{BG}\fnm{Björn} \snm{Grüning}} \orcidicon{0000-0002-3079-6586}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter the authors' addresses here        %%
%%                                          %%
%% Repeat \address commands as much as      %%
%% required.                                %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\address[id=aff1]{%                           % unique id
   \orgname{Department of Computer Science, University of Freiburg}, % university, etc
   \street{Georges-Köhler-Allee 106},                     %
  %\postcode{}                                % post or zip code
   \city{Freiburg},                              % city
   \cny{Germany}                                    % country
}
\address[id=aff2]{%
  \orgname{Scientific Computing Research Unit, University of Cape Town},
  \postcode{7700}
  \city{Cape Town},
  \cny{South Africa}
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Enter short notes here                   %%
%%                                          %%
%% Short notes will be after addresses      %%
%% on first page.                           %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{artnotes}
%\note{Sample of title note}     % note to the article
\note[id=n1]{Equal contributor} % note, connected to author
\end{artnotes}

\end{fmbox}% comment this for two column layout

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The Abstract begins here                 %%
%%                                          %%
%% Please refer to the Instructions for     %%
%% authors on http://www.biomedcentral.com  %%
%% and include the section headings         %%
%% accordingly for your article type.       %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{abstractbox}

\begin{abstract} % abstract
This paper is a tutorial developed for the data analysis platform Galaxy. The
Galaxy's concept makes high-throughput computational data analysis a
structured, reproducible and transparent process. In this tutorial we
focus on 3 questions: How are protein-ligand systems parameterized for
molecular dynamics simulation? What kind of analysis can be carried out
on molecular trajectories? How can high-throughput MD be used to study
multiple ligands? After finishing you will be able to learn about
force-fields and MD parameterization, learn how to conduct MD simulation
and analysis for a protein-ligand system, understand how different
molecular interactions contribute to the binding affinity of various
ligands for the Hsp90 protein. Requirements for this tutorial is a
minimal Galaxy experience and a Galaxy account on the Galaxy Europe
server. The estimated duration of this tutorial is around 3 hours.

\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The keywords begin here                  %%
%%                                          %%
%% Put each keyword in separate \kwd{}.     %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{keyword}
\kwd{Galaxy}
\kwd{Molecular Dynamics}
\kwd{Repeatable}
\end{keyword}

% MSC classifications codes, if any
%\begin{keyword}[class=AMS]
%\kwd[Primary ]{}
%\kwd{}
%\kwd[; secondary ]{}
%\end{keyword}

\end{abstractbox}
%
%\end{fmbox}% uncomment this for twcolumn layout

\end{frontmatter}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% The Main Body begins here                %%
%%                                          %%
%% Please refer to the instructions for     %%
%% authors on:                              %%
%% http://www.biomedcentral.com/info/authors%%
%% and include the section headings         %%
%% accordingly for your article type.       %%
%%                                          %%
%% See the Results and Discussion section   %%
%% for details on how to create sub-sections%%
%%                                          %%
%% use \cite{...} to cite references        %%
%%  \cite{koon} and                         %%
%%  \cite{oreg,khar,zvai,xjon,schn,pond}    %%
%%  \nocite{smith,marg,hunn,advi,koha,mouse}%%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%% start of article main body
% <put your article body there>

%%%%%%%%%%%%%%%%
%% Background %%
%%


%\linenumbers

\hypertarget{introduction}{%
\section*{Introduction}\label{introduction}}

Molecular dynamics (MD) is a commonly used method in computational chemistry and cheminformatics, in particular for studying the interactions between small molecules and large biological macromolecules such as proteins.~\cite{berendsen01} However, the barrier to entry for MD simulation is high; not only is the theory difficult to master, but commonly used MD software is technically demanding. Furthermore, generating reliable, reproducible simulation data requires the user to maintain detailed records of all parameters and files used, which again poses a challenge to newcomers to the field. One solution to the latter problem is usage of a workflow management system~\cite{senapathi_biomolecular_2019} such as Galaxy, KNIME or CWL; all of which provide molecular dynamics tools/nodes.

This tutorial provides a detailed workflow for high-throughput molecular dynamics with Galaxy, using the N-terminal domain of Hsp90 (heat shock protein 90) as a case-study. Galaxy \cite{afgan_galaxy_2018} is a data analysis platform that provides access to thousands of tools for scientific computation. It features a web-based user interface while automatically and transparently managing underlying computation details. Galaxy's
concept makes high-throughput data analysis a structured, reproducible and transparent process. This tutorial provides sample data, workflows, hands-on material and references for further reading.

The aim of this tutorial is to guide the user through the various steps of a molecular dynamics study, from accessing publicly available crystal structures, to performing MD simulation (leveraging the popular GROMACS~\cite{abraham_gromacs_2015} engine), to analysis of the results.

The entire analysis described this article can be conducted efficiently on any Galaxy server which has the needed tools. In particular, we recommend using the Galaxy Europe server
(\url{https://cheminformatics.usegalaxy.eu/}) or the Galaxy South Africa server (\url{https://galaxy-compchem.ilifu.ac.za/}).

The tutorial presented in this article has been developed by the Galaxy Training Network \cite{Batut2018} and its most up-to-date version is available online on the \href{https://training.galaxyproject.org/topics/computational-chemistry/tutorials/htmd-analysis/tutorial.html}{Galaxy Training Materials} website.


\subsection*{What is high-throughput molecular
dynamics?}\label{what-is-high-throughput-molecular-dynamics}

Molecular dynamics (MD) is a method to simulate molecular motion by
iterative application of Newton's laws of motion. It is often applied to
large biomolecules such as proteins or nucleic acids. A common
application is to assess the interaction between these macromolecules
and a number of small molecules (e.g.~potential drug candidates). This
tutorial provides a guide to setting up and running a high-throughput
workflow for screening multiple small molecules, using the open-source
GROMACS tools provided through the Galaxy platform.

\subsection*{Why is Hsp90 interesting to
study?}\label{why-is-hsp90-interesting-to-study}

The 90 kDa heat shock protein (Hsp90) is a chaperone protein responsible
for catalyzing the conversion of a wide variety of proteins to a
functional form; examples of the Hsp90 clientele, which totals several
hundred proteins, include nuclear steroid hormone receptors and protein
kinases.~\cite{Pearl2006} The mechanism by which Hsp90 acts varies between clients, as
does the client binding site; the process is dependent on
post-translational modifications of Hsp90 and the identity of
co-chaperones which bind and regulate the conformational cycle.

Due to its vital biochemical role as a chaperone protein involved in
facilitating the folding of many client proteins, Hsp90 is an attractive
pharmaceutical target. In particular, as protein folding is a potential
bottleneck to slow cellular reproduction and growth, blocking Hsp90
function using inhibitors which bind tightly to the ATP binding site
could assist in treating cancer; for example, the antibiotic
geldanamycin and its analogs are under investigation as possible
anti-tumor agents.

\begin{figure}[h!]
  \includegraphics[width=0.4\textwidth]{hsp90lig}
    \caption{\csentence{Hsp90 cartoon view.}
    Hsp90 cartoon rendered with ligands in active site}
\label{fig:Hsp90}
 \end{figure}

\hypertarget{methods}{%
\section*{Methods}\label{methods}}
\hypertarget{simulation}{%
\section*{Simulation}\label{simulation}}

\subsection*{Get data}\label{get-data}

As a first step, we download a crystal structure for the Hsp90 protein from the Protein Data Bank (PDB). The structure is provided under accession code \texttt{6HHR}~\cite{Schuetz2018} and shows Hsp90 in complex with a ligand belonging to the resorcinol class.

\begin{handson_box_colour}{Data upload}
%\textbf{Hands-on: Data upload}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Create a new history for this tutorial

\item
  Rename the dataset to `Hsp90 structure'
\item
  Search Galaxy for the \textbf{Get PDB} tool. Request the accession code \texttt{6HHR}.
\end{enumerate}
\end{handson_box_colour}

\subsection*{Topology generation}\label{topology-generation}

Now we have downloaded a PDB structure of the protein we wish to study, we will start preparing it for MD simulation; this process may also be referred to as parameterization or topology generation.

GROMACS distinguishes between constant and dynamic attributes of the
atoms in the system. The constant attributes (e.g. atom charges, bonds
connecting atoms) are listed in the topology (TOP file), while dynamic
attributes (attributes that can change during a simulation, e.g. atom
position, velocities and forces) are stored in structure (PDB or GRO)
and trajectory (XTC and TRR) files.

The PDB file we start from only explicitly states atom type (i.e. carbon, oxygen, and so on) and
3D Cartesian coordinates of each atom; additionally, it will usually not include hydrogen atoms. Therefore, before beginning simulation, we need to calculate
the rest of the information contained within the topology file. There
are a range of force fields to perform these calculations (for a recent, accessible overview see ~\cite{Lemkul2020}.

% perhaps some more discussion here and a citation of https://www.sciencedirect.com/science/article/pii/S1877117319302157

\subsubsection*{Extract protein and ligand
coordinates}\label{extract-protein-and-ligand-coordinates}

Parameterization needs to be done separately for the ligand and protein.
Therefore, the first step is to separate the PDB file into two sets of
coordinates - one for the ligand and one for the protein. Here, we can make use of the simple text manipulation tools integrated into Galaxy.

\begin{handson_box_colour}{Separate protein and ligand coordinates}
%\textbf{Hands-on: Separate protein and ligand coordinates}\label{hands-on-task-description}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  \textbf{Search in textfiles} with the following parameters:
  \begin{itemize}
  \tightlist
  \item
    \emph{``Select lines from''}: `Hsp90 structure'
  \item
    \emph{``that''}: \texttt{Don\textquotesingle{}t\ Match}
  \item
    \emph{``Regular Expression''}: \texttt{HETATM}
  \end{itemize}
\item
  Rename output to `Protein (PDB)'
\item
  \textbf{Search in textfiles} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``Select lines from''}: `Hsp90 structure'
  \item
    \emph{``that''}: \texttt{Match}
  \item
    \emph{``Regular Expression''}: \texttt{AG5E}
  \end{itemize}
\item
  Rename output to `Ligand (PDB)'
\end{enumerate}

\end{handson_box_colour}

Here, we simply filter the original PDB twice: once for lines which do not match \texttt{HETATM}, which returns a PDB file containing only protein, not ligand and solvent; and once for lines which match the ligand's identity code \texttt{AG5E}, which returns a PDB file containing only the ligand.

\hypertarget{set-up-protein-topology}{%
\subsubsection*{Set up protein topology}\label{set-up-protein-topology}}

Firstly, we need to calculate the topology for the protein file. We will
use the \textbf{GROMACS initial setup} tool.

\begin{handson_box_colour}{Generate protein topology}
%\textbf{Hands-on: Generate protein topology}\label{hands-on-task-description-1}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS initial setup} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``PDB input file''}: `Protein (PDB)' file
  \item
    \emph{``Force field''}: \texttt{gaff}
  \item
    \emph{``Water model''}: \texttt{TIP3P}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}
\end{handson_box_colour}

A force field is essentially a function to calculate the potential energy of a system, based on various empirical parameters (for the atoms, bonds, charges, dihedral angles and so on). There are a number of families of forcefields; some of the most commonly used include CHARMM~\cite{Vanommeslaeghe2009}, AMBER~\cite{Maier2015}, GROMOS~\cite{reif2012} and OpenFF~\cite{Mobley2018}. We will use \texttt{ff14SB}, which is the main Amber forcefield for protein modelling.

A wide range of models exist for modeling water. Here we are using the common TIP3P model, which is an example of a `three-site model' - so-called because the molecule is modeled using three points, corresponding to the three atoms of water. (Four- and five-site models include additional 'dummy atoms' representing the negative charges of the lone pairs of the oxygen atom)~\cite{Onufriev2017}.

The tool produces four outputs: a GRO file (containing the coordinates
of the protein), a TOP file (containing other information, including on
charges, masses, bonds and angles), an ITP file (which will be used to
restrain the protein position in the equilibration step later on), and a
log for the tool.

Please note all GROMACS tools output a log. It provides useful information for
debugging if we encounter any problems.

\subsubsection*{Generate a topology for the
ligand}\label{generate-a-topology-for-the-ligand}

To generate a topology for the ligand, we will use the \textbf{acpype}
tool. This provides a convenient interface to the AmberTools suite and
allows us to easily create the ligand topology in the format required by
GROMACS.

\begin{handson_box_colour}{Generate ligand topology}
%\textbf{Hands-on: Generate ligand topology}\label{hands-on-task-description-2}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{Generate MD topologies for small molecules} with the following
  parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``Input file''}: `Ligand (PDB)'
  \item
    \emph{``Charge of the molecule''}: \texttt{0}
  \item
    \emph{``Multiplicity''}: \texttt{1}
  \item
    \emph{``Force field to use for parameterization''}:
    \texttt{gaff}
  \item
    \emph{``Save GRO file?''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

Here, we use GAFF (general AMBER force field), which is a generalized AMBER force field~\cite{Wang2004} which can be applied to almost any small organic molecule, not just macromolecules such as proteins.

We select charge and multiplicity as appropriate. The ligand studied here is neutral, so the charge is 0. The multiplicity is 1, which will be the case for every simple organic molecule we encounter; only if we deal with more exotic species such as metal complexes or carbenes will we need to consider higher values.

\subsection*{Solvation and energy
minimization}\label{solvation-and-energy-minimization}

Having generated topologies, we now need to combine them, define the box
which contains the system, add solvent and ions, and perform an energy
minimization step.

\subsubsection*{Combine topology and GRO
files}\label{combine-topology-and-gro-files}

While we have separate topology and structure files for both protein and ligand, we need to combine them into a single set of files to continue with the simulation setup. A dedicated Galaxy tool is provided for this, using the Python library ParmEd~\cite{Swails2016}.

\begin{handson_box_colour}{Combine GRO and topology files}
%\textbf{Hands-on: Combine GRO and topology files}\label{hands-on-task-description-2}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{Merge GROMACS topologies} with the following
  parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``Protein topology (TOP) file''}: \texttt{TOP} file created by the \textbf{GROMACS initial setup tool}
  \item
    \emph{``Ligand topology (TOP or ITP) file''}: \texttt{Topology} file created by the \textbf{acpype}
  \item
    \emph{``Protein structure (GRO) file''}: \texttt{GRO} file created by the \textbf{GROMACS initial setup tool}
  \item
    \emph{``Ligand structure (GRO) file''}: \texttt{Structure file (GRO format)} file created by the \textbf{acpype}

  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

We now have a single GRO and TOP file, unifying the protein-ligand complex structure and topology.

\subsubsection*{\texorpdfstring{Create the simulation box with
\textbf{GROMACS structure
configuration}}{Create the simulation box with GROMACS structure configuration}}\label{create-the-simulation-box-with-gromacs-structure-configuration}

The next step, once combined coordinate (GRO) and topology (TOP) files
have been created, is to create a simulation box in which the system is
situated.

\begin{handson_box_colour}{Create simulation box}

%\hypertarget{hands-on-task-description-3}{%
%\textbf{Hands-on: Create simulation box}\label{hands-on-task-description-3}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% %\tightlist
% \item
  \textbf{GROMACS structure configuration} with the following
  parameters:

  \begin{itemize}
%  \tightlist
  \item
    \emph{``Input structure''}: \texttt{System\ GRO\ file} (Input
    dataset)
  \item
    \emph{``Configure box?''}: \texttt{Yes}

    \begin{itemize}
%    \tightlist
    \item
      \emph{``Box dimensions in nanometers''}: \texttt{1.0}
    \item
      \emph{``Box type''}: \texttt{Triclinic}
    \end{itemize}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

This tool returns a new GRO structure file, containing the same coordinates as before, but defining a simulation box such that every atom is a minimum of 1 nm from the box boundary. A variety of box shapes are available to choose: we select triclinic, as it provides the most efficient packing in space and thus fewer computational resources need to be devoted to simulation of solvent. 

\subsubsection*{Solvation}\label{solvation}
The next step is solvation of the newly created simulation box. Note
that the system is charged (depending on the pH) - the solvation tool
also adds sodium or chloride ions (replacing existing water molecules) as required to neutralize this.

\begin{handson_box_colour}{Solvation}

%\textbf{Hands-on: Solvation}\label{hands-on-task-description-4}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS solvation and adding ions} with the following
  parameters:
  \begin{itemize}
  \tightlist
  \item
    \emph{``GRO structure file''}: \texttt{output} (output of
    \textbf{GROMACS structure configuration} )
  \item
    \emph{``System topology''}: \texttt{output}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

\subsubsection*{Energy minimization}\label{energy-minimization}

The next step is energy minimization, which can be carried out using the
\textbf{GROMACS energy minimization} tool. The purpose of energy minimization is to relax the structure, removing any steric clashes or unusual geometry which would artificially raise the energy of the system.

\begin{handson_box_colour}{Energy minimization}

%\textbf{Hands-on: Energy minimization}\label{hands-on-task-description-5}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS energy minimization} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``GRO structure file.''}: \texttt{output1} (output of
    \textbf{GROMACS solvation and adding ions} )
  \item
    \emph{``Topology (TOP) file.''}: \texttt{output2} (output of
    \textbf{GROMACS solvation and adding ions} )
  \item
    \emph{``Parameter input''}:
    \texttt{Use\ default\ (partially\ customisable)\ setting}

    \begin{itemize}
    \tightlist
    \item
      \emph{``Number of steps for the MD simulation''}: \texttt{50000}
    \item
      \emph{``EM tolerance''}: \texttt{1000.0}
    \end{itemize}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \item
    Rename output to \texttt{Minimized\ GRO\ file}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

The EM tolerance here refers to the maximum force which will be allowed in a minimized system. The simulation will be terminated when the maximum force is less than this value, or when 50000 steps have elapsed.

\subsection*{Equilibration}\label{equilibration}

At this point equilibration of the solvent around the solute (i.e. the protein) is necessary. This is performed in two stages: equilibration under an NVT ensemble, followed by an NPT ensemble. Use of the NVT ensemble entails maintaining constant number of particles, volume and temperature, while the NPT ensemble maintains constant number of particles, pressure and temperature (The NVT ensemble is also known as the isothermal-isochoric ensemble, while the NPT ensemble is also known as the isothermal-isobaric ensemble).

For equilibration, the protein must be held in place while the solvent is allowed to move freely around it. This is achieved using the position restraint file (ITP) we created in system setup. When we specify this restraint, protein movement is not totally forbidden, but is energetically punished.

\begin{handson_box_colour}{NVT
equilibration}

%\textbf{Hands-on: NVT equilibration}\label{hands-on-nvt-equilibration}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS simulation} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``GRO structure file''}: \texttt{Minimized\ GRO\ file} (from
    energy minimization step)
  \item
    \emph{``Topology (TOP) file''}: TOP file produced by solvation step.
  \item
    In \emph{``Inputs''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Position restraint (ITP) file''}: ITP file produced by
      initial setup step.
    \end{itemize}
  \item
    In \emph{``Outputs''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Trajectory output''}:
      \texttt{Return\ .xtc\ file\ (reduced\ precision)}
    \item
      \emph{``Structure output''}: \texttt{Return\ .gro\ file}
    \item
      \emph{``Produce a checkpoint (CPT) file''}:
      \texttt{Produce\ CPT\ output}
    \end{itemize}
  \item
    In \emph{``Settings''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Parameter input''}:
      \texttt{Use\ default\ (partially\ customisable)\ setting}

      \begin{itemize}
      \tightlist
      \item
        \emph{``Bond constraints (constraints)''}:
        \texttt{All\ bonds\ (all-bonds).}
      \item
        \emph{``Temperature /K''}: \texttt{300}
      \item
        \emph{``Step length in ps''}: \texttt{0.0002}
      \item
        \emph{``Number of steps that elapse between saving data points
        (velocities, forces, energies)''}: \texttt{1000}
      \item
        \emph{``Number of steps for the simulation''}: \texttt{50000}
      \end{itemize}
    \end{itemize}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

Having stabilized the temperature of the system with NVT equilibration,
we also need to stabilize the pressure of the system. We therefore
equilibrate again using the NPT (constant number of particles, pressure,
temperature) ensemble.

Note that we can continue where the last simulation left off (with new
parameters) by using the checkpoint (CPT) file saved at the end of the
NVT simulation.

\begin{handson_box_colour}{NPT
equilibration}

%\textbf{Hands-on: NPT equilibration}\label{hands-on-npt-equilibration}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS simulation} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``GRO structure file''}: GRO output of \textbf{GROMACS
    simulation} (NVT equilibration)
  \item
    \emph{``Topology (TOP) file''}: TOP file produced by solvation step.
  \item
    In \emph{``Inputs''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Checkpoint (CPT) file''}: Output of \textbf{GROMACS
      simulation} (NVT equilibration))
    \item
      \emph{``Position restraint (ITP) file''}: ITP file produced by
      initial setup step.
    \end{itemize}
  \item
    In \emph{``Outputs''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Trajectory output''}:
      \texttt{Return\ .xtc\ file\ (reduced\ precision)}
    \item
      \emph{``Structure output''}: \texttt{Return\ .gro\ file}
    \item
      \emph{``Produce a checkpoint (CPT) file''}:
      \texttt{Produce\ CPT\ output}
    \end{itemize}
  \item
    In \emph{``Settings''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Ensemble''}: \texttt{Isothermal-isobaric\ ensemble\ (NPT)}
    \item
      \emph{``Parameter input''}:
      \texttt{Use\ default\ (partially\ customisable)\ setting}

      \begin{itemize}
      \tightlist
      \item
        \emph{``Bond constraints (constraints)''}:
        \texttt{All\ bonds\ (all-bonds).}
      \item
        \emph{``Temperature /K''}: \texttt{300}
      \item
        \emph{``Step length in ps''}: \texttt{0.002}
      \item
        \emph{``Number of steps that elapse between saving data points
        (velocities, forces, energies)''}: \texttt{1000}
      \item
        \emph{``Number of steps for the simulation''}: \texttt{50000}
      \end{itemize}
    \end{itemize}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}


\subsection*{Main simulation}\label{main-simulation}

We can now remove the restraints and continue with the simulation. The
simulation will run for 1 million steps, with a step size of 1 fs, so
will have a total length of 1 ns.

\begin{handson_box_colour}{Main simulation}

%\hypertarget{hands-on-task-description-6}{%
%\textbf{Hands-on: Task description}\label{hands-on-task-description-6}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS simulation} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``GRO structure file''}: Output of \textbf{GROMACS simulation}
    (NPT equilibration)
  \item
    \emph{``Topology (TOP) file''}: Output of the solvation step
  \item
    In \emph{``Inputs''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Checkpoint (CPT) file''}: Output of \textbf{GROMACS
      simulation} (NPT simulation))
    \end{itemize}
  \item
    In \emph{``Outputs''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Trajectory output''}:
      \texttt{Return\ .xtc\ file\ (reduced\ precision)}
    \item
      \emph{``Structure output''}: \texttt{Return\ .gro\ file}
    \item
      \emph{``Produce a checkpoint (CPT) file''}:
      \texttt{Produce\ CPT\ output}
    \end{itemize}
  \item
    In \emph{``Settings''}:

    \begin{itemize}
    \tightlist
    \item
      \emph{``Ensemble''}: \texttt{Isothermal-isobaric\ ensemble\ (NPT)}
    \item
      \emph{``Parameter input''}:
      \texttt{Use\ default\ (partially\ customisable)\ setting}

      \begin{itemize}
      \tightlist
      \item
        \emph{``Temperature /K''}: \texttt{300}
      \item
        \emph{``Step length in ps''}: \texttt{0.001}
      \item
        \emph{``Number of steps that elapse between saving data points
        (velocities, forces, energies)''}: \texttt{1000}
      \item
        \emph{``Number of steps for the simulation''}: \texttt{1000000}
      \end{itemize}
    \end{itemize}
  \item
    \emph{``Generate detailed log''}: \texttt{Yes}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

\hypertarget{analysis}{%
\section*{Analysis}\label{analysis}}

An analysis of the GROMACS simulation outputs will be carried out using Galaxy tools developed for computational chemistry\cite{senapathi_biomolecular_2019} based on popular analysis software - MDAnalysis\cite{michaudagrawal_mdanalysis_2011}, MDTraj\cite{mcgibbon_mdtraj_2015}, Bio3D\cite{skjaerven_integrating_2014} and MMPBSA.py\cite{miller_mmpbsa}. 



\hypertarget{create-pdb-file-needed-by-most-analysis-tools}{%
\subsubsection*{Create PDB file needed by most analysis
tools}\label{create-pdb-file-needed-by-most-analysis-tools}}

Before beginning a detailed analysis the structure and trajectory files generated previously need to be converted into different formats. First, convert the structural coordinates of the system in GRO format into PDB format. This PDB file will be used by most analysis tools as a starting structure. This tool can also be used to carry out initial setup for GROMACS simulations and convert from PDB to GRO format.

\begin{handson_box_colour}{Convert structural coordinates}
% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{GROMACS structure configuration} with the following
  parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``Output format''}: \texttt{PDB\ file}
  \item
    \emph{``Configure box?''}: \texttt{No}
  \end{itemize}
% \end{enumerate}
\end{handson_box_colour}

\hypertarget{convert-trajectory-to-dcd-format}{%
\subsubsection*{Convert trajectory to DCD
format}\label{convert-trajectory-to-dcd-format}}

Next, convert from XTC to DCD format. A number of the analysis tools being
used have been built to analyse trajectories in CHARMM's DCD format. This tool can also be used to interconvert between several other trajectory formats. A downside is that data is being duplicated and utilising further storage space on the Galaxy server.

\begin{handson_box_colour}{Convert trajectory format}


%\hypertarget{hands-on-task-description-8}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-8}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{MDTraj file converter} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``Output format''}: \texttt{DCD\ file} \textgreater{}
  \end{itemize}
% \end{enumerate}

\end{handson_box_colour}

\hypertarget{rmsd-analysis}{%
\subsection*{RMSD analysis}\label{rmsd-analysis}}


To check the stability and conformation of the protein and ligand through the course of the simulation the RMSD and RMSF are calculated.
RMSD is a standard measure of structural distance between coordinate
sets that measures the average distance between a group of atoms. The
RMSD of the C$\alpha$ atoms of the protein backbone is calculated here and
is a measure of how much the protein conformation has changed between different time
points in the trajectory. An RMSD on C$\alpha$ atoms will select all protein C$\alpha$ atoms, where the ligand is also a protein consider a different selection. 

For the RMSD analysis of ligand, the 'Select domains' parameter of the tool is set to choose 'Ligand', however this automatic selection always correct. Further selection can be done the 'Residue ID' which is then specified in the textbox provided. In this example the ligand's Residue ID is 'UNL'.

\begin{handson_box_colour}{RMSD Analysis: protein}
%\hypertarget{hands-on-task-description-9}{%
%\subsubsection*{Hands-on: Task description}\label{hands-on-task-description-9}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{RMSD Analysis} with the following parameters:

  \begin{itemize}
  \tightlist
    \item
    \emph{``DCD trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Select domains''}: \texttt{C-alpha}
  \end{itemize}

% \end{enumerate}
\end{handson_box_colour}

%\hypertarget{hands-on-task-description-10}{%
%\subsubsection*{Hands-on: Task description}\label{hands-on-task-description-10}}
\begin{handson_box_colour}{RMSD Analysis: ligand}
% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{RMSD Analysis} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Select domains''}: \texttt{Ligand}
  \end{itemize}

% \end{enumerate}
\end{handson_box_colour}

%\hypertarget{hands-on-task-description-11}{%
%\subsubsection*{Hands-on: Task
%description}\label{hands-on-task-description-11}}
\begin{handson_box_colour}{RMSD Analysis: ligand using Residue ID}
% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{RMSD Analysis} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Select domains''}: \texttt{Residue\ ID}

    \begin{itemize}
    \tightlist
    \item
      \emph{``Residue ID''}: \texttt{UNL}
    \end{itemize}
  \end{itemize}

% \end{enumerate}


\end{handson_box_colour}



\hypertarget{rmsf-analysis}{%
\subsection*{RMSF analysis}\label{rmsf-analysis}}

The Root Mean Square Fluctuation (RMSF) is valuable to consider as it represents the deviation at a reference position over time. The fluctuation of particular amino acids in the protein are considered. The C$\alpha$ of the protein, designated by C-alpha, is a good selection to understand the change in protein structure. Depending on the system these fluctuations can be correlated to experimental techniques including Nuclear Magnetic Resonance (NMR) and M\"{o}ssbauer spectrocopy. 

\begin{handson_box_colour}{RMSF Analysis}


%\hypertarget{hands-on-task-description-12}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-12}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{RMSF Analysis} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Select domains''}: \texttt{C-alpha}
  \end{itemize}

% \end{enumerate}


\end{handson_box_colour}


\hypertarget{pca-analysis}{%
\subsection*{PCA analysis}\label{pca-analysis}}

Principal component analysis (PCA) converts a set of correlated
observations (movement of all atoms in protein) to a set of principal
components which are linearly independent (or uncorrelated). Here several related tools are used to  calculate the PCA, visualize it and also calculate the cosine content. The C$\alpha$ carbons of the protein backbone is again a good selection for this purpose. 

\begin{handson_box_colour}{PCA Analysis with BIO3D}

%\hypertarget{hands-on-task-description-13}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-13}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{PCA} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Select domains''}: \texttt{C-alpha}
  \end{itemize}

% \end{enumerate}
\end{handson_box_colour}

%\hypertarget{hands-on-task-description-14}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-14}}
\begin{handson_box_colour}{Cosine content calculation}
% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{Cosine Content} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD/XTC trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB/GRO input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \end{itemize}


% \end{enumerate}

\end{handson_box_colour}

\begin{handson_box_colour}{PCA visualisation}
%\hypertarget{hands-on-task-description-15}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-15}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{PCA visualization} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Select domains''}: \texttt{C-alpha}
  \end{itemize}

% \end{enumerate}


\end{handson_box_colour}


\hypertarget{hydrogen-bond-analysis}{%
\subsection*{Hydrogen bond analysis}\label{hydrogen-bond-analysis}}

Hydrogen bonding interactions contribute to binding and are worth
investigating, in particular persistent hydrogen bonds. All possible hydrogen bonding interactions between the two selected regions, here the protein and the ligand, are investigated over time using VMD.

\begin{handson_box_colour}{Hydrogen bond analyis}
%\hypertarget{hands-on-task-description-16}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-16}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{Hydrogen Bond Analysis using VMD} with the following
  parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``DCD/XTC trajectory input''}: \texttt{output} (output of
    \textbf{MDTraj file converter} )
  \item
    \emph{``PDB/GRO input''}: \texttt{output} (output of \textbf{GROMACS
    structure configuration} )
  \item
    \emph{``Selection 1''}: \texttt{protein}
  \item
    \emph{``Selection 2''}: \texttt{resname\ UNL}
  \end{itemize}


% \end{enumerate}

\end{handson_box_colour}


\hypertarget{optional-estimate-the-binding-free-energy}{%
\subsection*{Estimate the binding free
energy}\label{optional-estimate-the-binding-free-energy}}

The binding free energy between a ligand and a receptor can be estimated using Molecular Mechanics Poisson-Boltzman or General Born Surface Area (MMPBSA or MMGBSA). For
the simplest form of calculation, a Single Trajectory Estimate, a
simulation of the complex in water is run, this was done with GROMACS
previously. The trajectory of this complex is used to estimate the
MMPBSA or MMGBSA depending on the options chosen. A General Born (GB)
calculation is recommended here as it completes in reasonable time.

\hypertarget{converting-parameters}{%
\subsubsection*{Converting parameters}\label{converting-parameters}}

The MMPBSA tool supports the AMBER topology format only. To convert from GROMACS
'.top' and '.gro' to AMBER topologies, use the following tool which uses
ParmEd to carry out the conversion. The result will be 4 AMBER .prmtop
files which are required for the binding free energy estimate
calculation.

\begin{handson_box_colour}{Parameter Conversion}

%\hypertarget{hands-on-task-description-17}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-17}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{Convert Parameters} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    \emph{``Force Field format''}: \texttt{GROMACS}

    \begin{itemize}
    \tightlist
    \item
      \emph{``Input topology (top) file''}: \texttt{output} (Input
      dataset)
    \item
      \emph{``Input structure (gro) file''}: \texttt{output} (Input
      dataset)
    \end{itemize}
  \item
    \emph{``Receptor selection''}: \texttt{:NA,CL,SOL,UNL}
  \item
    \emph{``Complex selection''}: \texttt{:NA,CL,SOL}
  \end{itemize}

% \end{enumerate}
\end{handson_box_colour}

\hypertarget{binding-free-energy-estimate}{%
\subsection*{Binding free energy estimate}\label{binding-free-energy-estimate}}

\begin{handson_box_colour}{Calculate MMGBSA}
%\hypertarget{hands-on-task-description-18}{%
%\subsubsection{Hands-on: Task
%description}\label{hands-on-task-description-18}}

% \begin{enumerate}
% \def\labelenumi{\arabic{enumi}.}
% \tightlist
% \item
  \textbf{mmpbsa mmgbsa} with the following parameters:

  \begin{itemize}
  \tightlist
  \item
    In \emph{``Input''}:
    \begin{itemize}
    \tightlist
    \item
      \emph{``Single or Multiple Trajectories''}:
      \texttt{Single\ Trajectory\ Protocol\ (STP)}

      \begin{itemize}
      \tightlist
      \item
        \emph{``AMBER prmtop input for Ligand''}: \texttt{output} (Input
        dataset)
      \end{itemize}
    \end{itemize}
  \item
    In \emph{``General parameters''}:
    \begin{itemize}
    \tightlist
    \item      
      \emph{``Final frame to analyse''}: \texttt{2000}
    \item      
      \emph{``interval between frames analysed''}: \texttt{5}
    \item      
      \emph{``quasi-harmonic entropy calculation''}: \texttt{No}
    \item
      \emph{``Strip mask''}: \texttt{:NA:SOL:CL}
    \end{itemize}
  \item
    In \emph{``Details of calculation and parameters''}:
    \begin{itemize}
    \tightlist
    \item
      \emph{``General Born calculation''}: \texttt{yes}
    \item
      \emph{``Poisson Boltzman calculation''}: \texttt{no}
    \item
      \emph{``Decomposition Analysis''}: \texttt{yes}
    \end{itemize}
  \end{itemize}


% \end{enumerate}


\end{handson_box_colour}

\hypertarget{optional-automating-high-throughput-calculations}{%
\subsection*{Automating high throughput
calculations with Galaxy}\label{optional-automating-high-throughput-calculations}}

In the scenario where large batches of simulations are needed, then
strategies to automate this process are required. Before rushing into high
throughput make sure to understand your process, the tools and
parameters, data and outputs quite well. Junk in will mean junk out. The
same applies for high-throughput, but not only will resourced be wasted but you will obtain high-throughput junk. First, understand the complete process for at least 2
systems and use this experience to understand where errors are likely to
occur. Second create a workflow and run this on 2-3 systems. Again check
for errors, complete a cursory analysis to ensure selected parameters
give reasonable results.\\
At this point you may realize that manual intervention is required for
certain systems. If this is at the setup stage, then create multiple
histories (either manually or perhaps with bioblend), complete the
manual task and then run a workflow. Realise if there is a manual task,
automation can only be applied to part of the system. Maybe manually
choosing to run workflows will be sufficient. Third start to consider
automation. Create a history with data that has been made into a
collection. Run your workflow. If this works that is great. If not
consider using BioBlend \cite{slogett_bioblend} and write scripts that interact with Galaxy via the API. 
Galaxy Training Material is available for both \href{https://galaxyproject.github.io/training-material/topics/galaxy-data-manipulation/tutorials/collections/tutorial.html}{collections} and \href{https://training.galaxyproject.org/training-material/topics/dev/tutorials/bioblend-api/slides.html}{BioBlend}




\hypertarget{resultsanddiscussion}{%
\section*{Results and Discussion}\label{resultsanddiscussion}}
After the completion of the simulation. An important question will often be is the simulation length sufficient. The timescale of motions of interest are in the picosecond to nanosecond range, these are motions such as domain vibration, hydrogen bond breaking, translation diffusion and side chain fluctuations. To observe meaningful conformational transitions of the protein then $\mu$s sampling would be needed, but this is not the purpose here. The PCA cosine content is another measure if it is close to 1 then the length is insufficient. While close to 0 is not enough to determine that this is sufficient. Here, the cosine content is 0.084, indicating that sampling is most likely sufficient.

\subsection*{RMSD protein}
The RMSD timeseries for the protein shows a thermally stable and equilibrated structure with
an average RMSD between 1 and 1.3. There are no large conformational changes during the simulation. The RMSD histogram confirms this, see Figure \ref{fig:rmsdprotein}.

\begin{figure}[h!]
  \includegraphics[width=0.4\textwidth]{htmd_analysis_rmsd1_merge}
  \caption{\csentence{RMSD for protein.}
      RMSD time series and histogram for the protein.}
  \label{fig:rmsdprotein}
\end{figure}
%\includegraphics{images/htmd_analysis_rmsd1_series.png}
%\includegraphics{images/htmd_analysis_rmsd1_histo.png}

\subsection*{RMSD ligand}
Calculating the RMSD of the ligand is necessary to check if it is stable in the active site and to identify possible binding modes. If the ligand is not stable the RMSD will fluctuate excessively and there will be large fluctuations in the RMSD.

In this case the RMSD seems to stabilise at 1.0 and then transitions back to 0.5. This is more clearly seen in the histogram. There is a bimodal distribution with centres at 0.3 and 1.0 which both have significant populations. There are two binding poses. These can be visually assessed. In this case the
poses were viewed in VMD \cite{hump_vmd_1996} (see Figure \ref{fig:rmsdligand}).

\begin{figure}[h!]
  \includegraphics[width=0.4\textwidth]{htmd_analysis_rmsd2_with_binding_merge}
  \caption{\csentence{RMSD for the ligand.}
      RMSD time series and histogram for the ligand, inset are images of the ligand conformation.}
  \label{fig:rmsdligand}
\end{figure}
%\includegraphics{images/htmd_analysis_rmsd2_series.png}
%\includegraphics{images/htmd_analysis_rmsd2_histo.png}
%\includegraphics{images/htmd_analysis_bindingposes.png}


\subsection*{RMSF}
When considering the RMSF fluctuations greater than 1 Angstrom are worth
considering. These are seen near residue position 50, 110 and 160. Very
large fluctuations are seen for the final residues i.e.~the C-terminus.
These are fairly common and no investigation is needed. The movement could be
related to binding or other motions, but is does correlate well with the most significant principal component determined by PCA.

% possibly RMSF fig but not really needed
\begin{figure}[h!]
  \includegraphics[width=0.4\textwidth]{htmd_analysis_pc1_rmsf}
  \caption{\csentence{RMSF for the protein.}
      RMSF}
\label{fig:rmsf}
\end{figure}
%\includegraphics{images/htmd_analysis_rmsf.png}

\subsection*{PCA}

The first principal component (PC1) is most important accounting for
32.36\% of the variance (see PC1 vs PC2 and Eigenvalue rank plots). More
information on PCA can be found in the
\href{http://thegrantlab.org/bio3d/tutorials/trajectory-analysis}{BIO3D tutorial}. The RMSF is in good correlation with PC1.

\begin{figure}[h!]
  \includegraphics[width=0.4\textwidth]{htmd_analysis_pca}
  \caption{\csentence{Principal Component Analysis.}
      PCA.}
 \label{fig:pca}
 \end{figure}
%\includegraphics{images/htmd_analysis_pca.png}
%\includegraphics{images/htmd_analysis_pc1_rmsf.png}

\subsection*{Hydrogen bonding and further analysis}
The active site of this protein is quite hydrophobic. Only 1 hydrogen
bond is seen between the ligand and Hsp90, this is between Threonine 184
and the ligand. This hydrogen bond is not persistent, the occupancy is
small, 0.20\%, the hydrogen is not present for most of the simulation
(according to the criteria for hydrogen bonding).
There are many alternative analyses that have not been considered for the sake of brevity. TODO consider adding another line or two.

An MMGBSA calculation using a single trajectory yields an binding estimate of -19.62 kcal/mol for this ligand. This negative value suggests a favorable complex, however the entropy contribution was not measured.

\hypertarget{conclusion}{%
\section*{Conclusion}\label{conclusion}}

We provide an overview of ...




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%% Backmatter begins here                   %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{backmatter}

\section*{Competing interests}
  The authors declare that they have no competing interests.

\section*{Author's contributions}
    Text for this section \ldots

\section*{Acknowledgements}
  Text for this section \ldots
  TODO: Include NRF funding and thanks to Galaxy EU and ilifu teams.
The Galaxy server that was used for some calculations is in part funded by Collaborative Research Centre 992 Medical Epigenetics (DFG grant SFB 992/1 2012) and German Federal Ministry of Education and Research (BMBF grants 031 A538A/A538C RBC, 031L0101B/031L0101C de.NBI-epi, 031L0106 de.STAIR (de.NBI)).
\section*{Data and material availability}
  Data and materials are available on GitHub:
  TODO\ldots
  \begin{itemize}
  \item   Public European Galaxy server(\url{https://cheminformatics.usegalaxy.eu/}) 
  \item Galaxy Computation Chemistry South Africa server (\url{https://galaxy-compchem.ilifu.ac.za/})
  \item Galaxy Training Materials website (\url{https://training.galaxyproject.org/topics/computational-chemistry/tutorials/htmd-analysis/tutorial.html})
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                  The Bibliography                       %%
%%                                                         %%
%%  Bmc_mathpys.bst  will be used to                       %%
%%  create a .BBL file for submission.                     %%
%%  After submission of the .TEX file,                     %%
%%  you will be prompted to submit your .BBL file.         %%
%%                                                         %%
%%                                                         %%
%%  Note that the displayed Bibliography will not          %%
%%  necessarily be rendered by Latex exactly as specified  %%
%%  in the online Instructions for Authors.                %%
%%                                                         %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% if your bibliography is in bibtex format, use those commands:
\bibliographystyle{bmc-mathphys} % Style BST file (bmc-mathphys, vancouver, spbasic).
\bibliography{bmc_article}      % Bibliography file (usually '*.bib' )
% for author-year bibliography (bmc-mathphys or spbasic)
% a) write to bib file (bmc-mathphys only)
% @settings{label, options="nameyear"}
% b) uncomment next line
%\nocite{label}

% or include bibliography directly:
% \begin{thebibliography}
% \bibitem{b1}
% \end{thebibliography}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Figures                       %%
%%                               %%
%% NB: this is for captions and  %%
%% Titles. All graphics must be  %%
%% submitted separately and NOT  %%
%% included in the Tex document  %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%
%% Do not use \listoffigures as most will included as separate files




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                               %%
%% Additional Files              %%
%%                               %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Additional Files}
  \subsection*{Additional file 1 --- Sample additional file title}
    Additional file descriptions text (including details of how to
    view the file, if it is in a non-standard format or the file extension).  This might
    refer to a multi-page table or a figure.

  \subsection*{Additional file 2 --- Sample additional file title}
    Additional file descriptions text.


\end{backmatter}
\end{document}
